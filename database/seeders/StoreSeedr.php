<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Store;
use App\Models\Employee;
use App\Models\Department;
use App\Models\User;
use Illuminate\Support\Facades\Hash;

class StoreSeedr extends Seeder
{
    public function run()
    {
        // Ensure Department exists
        $dept = Department::firstOrCreate(["name" => "General Staff"]);

        // Format: [Code (nullable), Store Name, Owner Name, Classification, Custody Type]
        $rows = [
            [1, "المستديم", "محسن شعبان", "المستديم", "مخزن رئيسي"],
            [2, "السيارات", "أحمد رزق", "المستديم", "مخزن رئيسي"],
            [3, "المستعمل", "أحمد رزق", "المستديم", "مخزن رئيسي"],
            [4, "الأدوات الكتابية", "أحمد رزق", "المستهلك", "مخزن رئيسي"],
            [5, "المطبوعات", "محسن شعبان", "المستهلك", "مخزن رئيسي"],
            [6, "الاستهلاكي", "محسن شعبان", "المستهلك", "مخزن رئيسي"],
            [7, "المحاصيل الزراعية", null, "المحاصيل الزراعية", "مخزن رئيسي"], // Note: Null Manager
            [8, "الخردة والكهنة", "محمد السيد عفيفي", "المستديم", "مخزن رئيسي"],
            [9, "الدفاتر المالية", "محسن شعبان", "المالية", "مخزن رئيسي"],
            [10, "أساسيات الهندسة", "عبد الله شعبان", "المستديم", "عهدة فرعية"],
            [11, "التحكم الآلي", "محسن عبد الوهاب", "المستديم", "عهدة فرعية"],
            [12, "التعليم الالكتروني", "خضر ترا", "المستديم", "عهدة فرعية"],
            [13, "الدوائر الرقمية", "عبد الله شعبان", "المستديم", "عهدة فرعية"],
            [
                14,
                "الدوائر المنطقية",
                "عبد الله شعبان",
                "المستديم",
                "عهدة فرعية",
            ],
            [16, "الالكترونيات بالورش", "رجب السيد", "المستديم", "عهدة فرعية"],
            [
                17,
                "الكيمياء الهندسية",
                "المعتصم بالله",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                18,
                "المعالجة الحرارية",
                "محمد السيد عفيفي",
                "المستديم",
                "عهدة فرعية",
            ],
            [19, "المواد المستحدثة", "نصار حسني", "المستديم", "عهدة فرعية"],
            [20, "الموارد المائية", "نصار حسني", "المستديم", "عهدة فرعية"],
            [21, "حاسب آلي", "خالد حنفي", "المستديم", "عهدة فرعية"],
            [
                22,
                "حاسب آلي ميكانيكا",
                "عبد الله شعبان",
                "المستديم",
                "عهدة فرعية",
            ],
            [23, "رعاية الشباب", "أحمد سلامة", "المستديم", "عهدة فرعية"],
            [24, "كمبيوتر عمارة", "خالد عبد العاطي", "المستديم", "عهدة فرعية"],
            [25, "كمبيوتر مدن", "نصار حسني", "المستديم", "عهدة فرعية"],
            [26, "كمبيوتر مساحة", "فتحي عبد المنعم", "المستديم", "عهدة فرعية"],
            [
                27,
                "محاكاة خطوط النقل الهوائية",
                "عبد الله شعبان",
                "المستديم",
                "عهدة فرعية",
            ],
            [28, "معمل حاسب آلي إعدادي", "خالد حنفي", "المستديم", "عهدة فرعية"],
            [29, "معمل الكيمياء (1)", "ياسر رزق", "المستديم", "عهدة فرعية"],
            [30, "معمل PLC", "عبد الله شعبان", "المستديم", "عهدة فرعية"],
            [31, "معمل الاحتراق", "محسن عبد الوهاب", "المستديم", "عهدة فرعية"],
            [32, "معمل الإنشاءات", "نصار حسني", "المستديم", "عهدة فرعية"],
            [33, "معمل البرمجيات", "عبد الله شعبان", "المستديم", "عهدة فرعية"],
            [34, "معمل التربة", "نصار حسني", "المستديم", "عهدة فرعية"],
            [35, "معمل الجهد العالي", "خالد حنفي", "المستديم", "عهدة فرعية"],
            [36, "معمل الخرسانة", "نصار حسني", "المستديم", "عهدة فرعية"],
            [37, "معمل السكة الحديد", "نصار حسني", "المستديم", "عهدة فرعية"],
            [39, "معمل الفيزياء", "سعيد السيد", "المستديم", "عهدة فرعية"],
            [
                40,
                "معمل القوى الكهربية",
                "عبد الله شعبان",
                "المستديم",
                "عهدة فرعية",
            ],
            [41, "معمل الهيدروليك", "م. هلال أنور", "المستديم", "عهدة فرعية"],
            [42, "معمل حاسب آلي", "عبد الله شعبان", "المستديم", "عهدة فرعية"],
            [43, "معمل مساحة", "فتحي عبد المنعم", "المستديم", "عهدة فرعية"],
            [
                44,
                "معمل ميكانيكا موائع",
                "محمد السيد عفيفي",
                "المستديم",
                "عهدة فرعية",
            ],
            [45, "ميكانيكا إعدادي", "أشرف حسانين", "المستديم", "عهدة فرعية"],
            [46, "هندسة الجهد", "خالد حنفي", "المستديم", "عهدة فرعية"],
            [47, "هندسة الطرق", "نصار حسني", "المستديم", "عهدة فرعية"],
            [48, "هندسة صحية", "نصار حسني", "المستديم", "عهدة فرعية"],
            [49, "هندسة صناعية", "جمال النجدي", "المستديم", "عهدة فرعية"],
            [50, "هيدروليك الورش", "دسوقي حسني", "المستديم", "عهدة فرعية"],
            [51, "وحدة المقررات", "فتحي عبد المنعم", "المستديم", "عهدة فرعية"],
            [52, "أساسيات التحكم", "محمد رمضان", "المستديم", "عهدة فرعية"],
            [53, "عيادة الأسنان", "انتصار عيد", "المستديم", "عهدة فرعية"],
            [54, "المجالات الكهربية", "خالد حنفي", "المستديم", "عهدة فرعية"],
            [
                55,
                "عهدة مبنى الخلفاوي",
                "سعيد عبد الظاهر",
                "المستديم",
                "عهدة فرعية",
            ],
            [56, "عهدة مبنى روض الفرج", "طارق عواد", "المستديم", "عهدة فرعية"],
            [
                57,
                "ورشة قطع المعادن",
                "محمود عبد الرازق",
                "المستديم",
                "عهدة فرعية",
            ],
            [58, "مركز الدراسات", "د. كريم رشوان", "المستديم", "عهدة فرعية"],
            [
                59,
                "معمل البرمجيات (2)",
                "عبد الله شعبان",
                "المستديم",
                "عهدة فرعية",
            ],
            [60, "معمل الشبكات", "رجب السيد", "المستديم", "عهدة فرعية"],
            [61, "معمل القياسات", "م. باسم رجب", "المستديم", "عهدة فرعية"],
            [63, "العيادة", "زينات صدقي", "المستديم", "عهدة فرعية"],
            [65, "معمل ليزر", "د. خالد العيسوي", "المستديم", "عهدة فرعية"],
            [66, "مقاومة المواد", "محسن عبد الوهاب", "المستديم", "عهدة فرعية"],
            [67, "هندسة التبريد", "د. الصاوي هان", "المستديم", "عهدة فرعية"],
            [68, "هندسة الطرق (2)", "طارق عواد", "المستديم", "عهدة فرعية"],
            [69, "ورشة البرادة", "محمد يوسف الجتوري", "المستديم", "عهدة فرعية"],
            [
                70,
                "ورشة الخراطة",
                "صابر محمد عبد الحميد",
                "المستديم",
                "عهدة فرعية",
            ],
            [71, "ورشة السباكة", "صابر سعد عطية", "المستديم", "عهدة فرعية"],
            [72, "ورشة السمكرة", "ناصر إبراهيم", "المستديم", "عهدة فرعية"],
            [73, "ورشة اللحام", "طاهر محمد", "المستديم", "عهدة فرعية"],
            [74, "ورشة الماكينات", "دسوقي حسني", "المستديم", "عهدة فرعية"],
            [
                75,
                "ورشة ألومنيوم",
                "محمد يوسف الجتوري",
                "المستديم",
                "عهدة فرعية",
            ],
            [76, "ورشة النجارة", "كرم محمود حسن", "المستديم", "عهدة فرعية"],
            [77, "ورشة حدادة", "عمرو محمد نجيب", "المستديم", "عهدة فرعية"],
            [78, "ورشة كهرباء", "أسامة بيومي شعبان", "المستديم", "عهدة فرعية"],
            [79, "ورشة CNC", "صابر محمد عبد الحميد", "المستديم", "عهدة فرعية"],
            [84, "الهوائيات", "ياسر حامد", "المستديم", "عهدة فرعية"],
            [85, "الاتصالات", "رجب السيد", "المستديم", "عهدة فرعية"],
            [
                null,
                "معمل القمر الصناعي التعليمي",
                "خالد حنفي",
                "المستديم",
                "عهدة فرعية",
            ],
            [null, "الاتصالات المتقدمة", "ياسر حامد", "المستديم", "عهدة فرعية"],
            [
                null,
                "معمل التحكم الآلي التفاعلي",
                "خالد حنفي",
                "المستديم",
                "عهدة فرعية",
            ],
            [null, "معمل حاسب آلي 2", "رجب السيد", "المستديم", "عهدة فرعية"],
            [
                null,
                "الكيمياء والنانوتكنولوجي",
                "جمال النجدي",
                "المستديم",
                "عهدة فرعية",
            ],
            [null, "حاسب آلي 3", "خالد حنفي", "المستديم", "عهدة فرعية"],
            [null, "الموجات الدقيقة", "ياسر حامد", "المستديم", "عهدة فرعية"],
            [
                null,
                "وحدة القياس والتقويم (1)",
                "طارق محمد عبدة",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                null,
                "وحدة القياس والتقويم (2)",
                "أميرة عادل يحيى",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                null,
                "وحدة القياس والتقويم (3)",
                "منى محمود",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                null,
                "وحدة القياس والتقويم (4)",
                "طارق عواد",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                null,
                "معمل حاسب آلي إعدادي (مكرر)",
                "خالد حنفي",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                null,
                "عهدة طفايات الحريق",
                "سعيد عبد الظاهر",
                "المستديم",
                "عهدة فرعية",
            ],
            [null, "أثاث العيادة", "ثناء أحمد", "المستديم", "عهدة فرعية"],
            [
                null,
                "أدوية مبنى الخلفاوي",
                "زينات صدقي",
                "المستديم",
                "عهدة فرعية",
            ],
            [null, "أدوية روض الفرج", "ثناء أحمد", "المستديم", "عهدة فرعية"],
            [
                null,
                "متحف قسم الجيوماتكس",
                "فتحي عبد المنعم",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                null,
                "عهدة مكتب العميد والقاعات",
                "محمد عبد المحسن",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                null,
                "عهدة الدور السابع (المكاتب الإدارية)",
                "تامر جمال",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                null,
                "عهدة الدور السادس علوم طبيعية",
                "أحمد عصام الدين",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                null,
                "عهدة الدور السابع مكاتب الوكلاء",
                "أحمد عمر أحمد",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                null,
                "عهدة الدور الثامن",
                "طارق محمد عبدة",
                "المستديم",
                "عهدة فرعية",
            ],
            [
                null,
                "عهدة الدور الثالث",
                "عبد الوهاب حمدي",
                "المستديم",
                "عهدة فرعية",
            ],
        ];

        foreach ($rows as $row) {
            $code = $row[0];
            $storeName = $row[1];
            $empName = $row[2];
            $classification = $row[3];
            $custodyType = $row[4];

            $responsibleEmployeeId = null; // Matches Schema: responsible_employee_id

            // Handle Employee Creation
            if ($empName && $empName !== "0") {
                // Generate a unique email based on name hash to prevent duplication issues
                $email =
                    "emp_" . substr(md5($empName), 0, 8) . "@feng.bu.edu.eg";

                $user = User::firstOrCreate(
                    ["email" => $email],
                    [
                        "name" => $empName,
                        "password" => Hash::make("password"),
                    ],
                );

                $employee = Employee::firstOrCreate(
                    ["name" => $empName],
                    [
                        "department_id" => $dept->id,
                        "job_title" => "أمين عهده",
                        "user_id" => $user->id,
                        // Note: SSN and Birth Date are left null as per migration update
                    ],
                );

                $responsibleEmployeeId = $employee->id;
            }

            // Create Store
            Store::updateOrCreate(
                ["name" => $storeName], // Check by Name
                [
                    "code" => $code,
                    // FIX: Changed from 'manager_id' to 'responsible_employee_id'
                    "responsible_employee_id" => $responsibleEmployeeId,
                    "classification" => $classification,
                    "custody_type" => $custodyType,
                ],
            );
        }

        $this->command->info(
            "Full PDF Data Seeded Successfully (" . count($rows) . " records).",
        );
    }
}
